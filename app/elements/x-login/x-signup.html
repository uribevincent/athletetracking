<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-styles/typography.html">

<dom-module id="x-signup">
  <template>
    <style include="shared-styles">
      :host {
        display: block;
      }


      span,
      input {
        @apply(--paper-font-body2);
      }
    </style>
    <span class="page-title"></span>
    <form  is="iron-form" id="form" >

 <paper-input label="Nom" value="{{name}}" required></paper-input>
 <paper-input label="Email" value="{{email}}" required></paper-input>
 <paper-input label="Mot de passe"  value="{{password}}" type="password"></paper-input><br>
 <paper-checkbox checked="{{isCoach}}">Coach</paper-checkbox><br>
 <paper-checkbox checked="{{isAthlete}}">Athlete</paper-checkbox>

<div hidden$="{{!isAthlete}}">
 <paper-input label="Date de naissance" value="{{birthDate}}"></paper-input>
 <paper-input label="Licence FFA" value="{{licenceNumber}}"></paper-input>
 <paper-input label="VMA estimée" value="{{speed}}"></paper-input>
 <paper-input label="Taille" value="{{height}}"></paper-input>
 <paper-input label="Poids" value="{{weight}}"></paper-input>
 <paper-input label="Nombre d'entraînements" value="{{availability}}"></paper-input>

</div>


 <paper-button raised on-tap="signup">Inscription</paper-button>



    </form>
</template>

  <script>
    (function() {
      'use strict';

      Polymer({
        is: 'x-signup',
        properties:{
        	email: String,
        	password: String
        },

 		signup: function() {
 			var ref = new Firebase(app.firebaseURL);
 			var name = this.name, email = this.email, pwd = this.password, isAthlete = this.isAthlete,
 			isCoach = this.isCoach, birthDate = this.birthDate, licenceNumber = this.licenceNumber,
 			speed = this.speed, height = this.height, weight = this.weight, availability = this.availability;

 			var user = app.$.auth.signInWithEmailAndPassword(email, pwd)
 			.catch(function(error) {
				// Handle Errors here.
				var errorCode = error.code;
				var errorMessage = error.message;
				if (error) {
					switch (error.code) {
						case "EMAIL_TAKEN":
							console.log("The new user account cannot be created because the email is already in use.");
							break;
						case "INVALID_EMAIL":
							console.log("The specified email is not a valid email.");
							break;
						default:
							console.log("Error creating user:", error);
					}
				}
			});
			ref.createUser({
			  email: email,
			  password: pwd
			}, function(error, userData) {
			  if (error) {
			    switch (error.code) {
			      case "EMAIL_TAKEN":
			        console.log("The new user account cannot be created because the email is already in use.");
			        break;
			      case "INVALID_EMAIL":
			        console.log("The specified email is not a valid email.");
			        break;
			      default:
			        console.log("Error creating user:", error);
			    }
			  } else {
			  	if(isAthlete){
			  		//save athlete
				  	var athletesRef = ref.child("athletes/" + userData.uid);
				  	athletesRef.set({
			  			name: name,
			  			vma: speed,
			  			height: height,
			  			weight: weight,
			  			birthDate: birthDate,
			  			licenceNumber: licenceNumber,
			  			availability: availability
			  		});
			  	}
			  	if(isCoach){
			  		var coachesRef = ref.child("coaches/" + userData.uid);
				  	coachesRef.set({
			  			name: name
			  		});
			  	}
						console.log("Successfully created user account with uid:", userData.uid);
				//login
				ref.authWithPassword({
					email    : email,
					password : pwd
				}, function(error, authData) {
					if(!error){
						app.authData = authData;
						//redirect
						app.route = "home";
						console.log("Successfully logged user account with uid:", authData.uid);
					}
				}, {
				  remember: "default"
				});

			  }
			});
        }


      });
    })();
  </script>
</dom-module>
